<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.145.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>soffensive blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://soffensive.github.io/">
<meta property="og:site_name" content="soffensive blog"><meta property="og:title" content="soffensive blog"><meta property="og:description" content="This is my cool site"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="soffensive blog"><meta name=twitter:description content="This is my cool site"><meta name=twitter:site content="@evisneffos"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://soffensive.github.io/><link rel=alternate href=/index.xml type=application/rss+xml title="soffensive blog"><link rel=feed href=/index.xml type=application/rss+xml title="soffensive blog"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/soffensive.github.io\/","inLanguage":"en","description":"This is my cool site","name":"soffensive blog"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class="page home" data-home=posts><div class=home-profile><h1 class=home-title>soffensive blog</h1><div class=home-subtitle><div id=id-1 class=typeit></div></div><div class=links><a href=https://github.com/soffensive title=GitHub target=_blank rel="noopener noreffer me"><i class="fab fa-github fa-fw" aria-hidden=true></i></a><a href=https://twitter.com/evisneffos title=Twitter target=_blank rel="noopener noreffer me"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a></div></div><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/practical-reverse-engineering/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue/>Practical Reverse Engineering Exercise Solutions: KeInitializeQueue</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2017-07-01>2017-07-01</time></span>&nbsp;<span class=post-category>included in <a href=/categories/practical-reverse-engineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Practical Reverse Engineering</a></span></div><div class=content><p>We are tasked with decompiling the Windows Kernel routine
KeInitializeQueue.</p><p>Firstly, we obtain its disassembly:</p><p><a href=../images/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png rel><img class=lazyload src=/svg/loading.min.svg data-src=../images/thumbnails/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png data-srcset="../images/thumbnails/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png, ../images/thumbnails/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png 1.5x, ../images/thumbnails/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png 2x" data-sizes=auto alt=../images/thumbnails/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png title=../images/thumbnails/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue-001.png></a> </p><p>Secondly, we consult <a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff549547%28v=vs.85%29.aspx" target=_blank rel="noopener noreffer">MSDN</a> for its signature:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>VOID</span> <span class=nf>KeInitializeQueue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=n>_Out_</span> <span class=n>PRKQUEUE</span> <span class=n>Queue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>_In_</span>  <span class=n>ULONG</span>    <span class=n>Count</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>The routine itself does not return anything. </p><p>We learn it takes two parameters and as the assembly contains the <code>ret 8</code> instruction, the <code>KeInitializeQueue</code> function cleans up the stack and thus, it uses the <strong>stdcall</strong> convention.</p></div><div class=post-footer><a href=/posts/practical-reverse-engineering/2017-07-01-practical-reverse-engineering-exercise-solutions-keinitializequeue/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/practical-reverse-engineering/>Practical Reverse Engineering</a>,&nbsp;<a href=/tags/x64/>X64</a>,&nbsp;<a href=/tags/x86/>X86</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/practical-reverse-engineering/2017-06-29-practical-reverse-engineering-exercise-solutions-obfastdereferenceobject/>Practical Reverse Engineering Exercise Solutions: ObFastDereferenceObject</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2017-06-29>2017-06-29</time></span>&nbsp;<span class=post-category>included in <a href=/categories/practical-reverse-engineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Practical Reverse Engineering</a></span></div><div class=content><p>First of all a quick reminder: This series of blog posts relates to exercises from the book Practical Reverse Engineering by Dang et al. Although it is called reverse engineering in general, it actually is mostly relevant to Microsoft Windows operating systems. This is simply due to the fact that Microsoft Windows is closed source in contrast to the Linux/Unix families, which means its source code is publicly available and so no reverse engineering endeavours are necessary.</p></div><div class=post-footer><a href=/posts/practical-reverse-engineering/2017-06-29-practical-reverse-engineering-exercise-solutions-obfastdereferenceobject/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/practical-reverse-engineering/>Practical Reverse Engineering</a>,&nbsp;<a href=/tags/x64/>X64</a>,&nbsp;<a href=/tags/x86/>X86</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/practical-reverse-engineering/2017-06-19-practical-reverse-engineering-exercise-solutions-keinitializeapc-routine/>Practical Reverse Engineering Exercise Solutions: KeInitializeApc Routine</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2017-06-19>2017-06-19</time></span>&nbsp;<span class=post-category>included in <a href=/categories/practical-reverse-engineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Practical Reverse Engineering</a></span></div><div class=content><p>To keep me motivated and document my progress, I will create a series of
blog posts with answers to some of the exercises from the book
&ldquo;Practical Reverse Engineering&rdquo; by Dang, Gazet and Bachaalany.</p><p>In the last post, we introduced the Windows Kernel Debugger (KD) and some of the functions. I have learned that rather than using KD directly, we can use WinDbg&rsquo;s interface which is more user-friendly. When calling livekd, simply append the &ldquo;-w&rdquo; parameter and WinDbg will start up:</p></div><div class=post-footer><a href=/posts/practical-reverse-engineering/2017-06-19-practical-reverse-engineering-exercise-solutions-keinitializeapc-routine/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/practical-reverse-engineering/>Practical Reverse Engineering</a>,&nbsp;<a href=/tags/x64/>X64</a>,&nbsp;<a href=/tags/x86/>X86</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/practical-reverse-engineering/2017-06-17-practical-reverse-engineering-exercise-solutions-windows-kernel-routines/>Practical Reverse Engineering Exercise Solutions: Windows Kernel Routines</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2017-06-17>2017-06-17</time></span>&nbsp;<span class=post-category>included in <a href=/categories/practical-reverse-engineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Practical Reverse Engineering</a></span></div><div class=content><p>I am currently developing my reverse engineering skills and want to keep
some important parts of this journey as well in this blog.</p><p>The first step of this series relates to disassembling Windows kernel
routines, in my case Windows 7.</p><p>What are the prerequisites for this exercise?</p><ul><li>Ideally, install Windows inside a virtual machine</li><li>From Windows Vista onwards, the Kernel debugging mode has to be enabled with: <code>bcdedit /debug on</code></li><li>Install Debugging Tools for Windows (for example, as part of the Windows SDK - <a href="https://www.microsoft.com/en-us/download/details.aspx?id=3138" target=_blank rel="noopener noreffer">https://www.microsoft.com/en-us/download/details.aspx?id=3138</a> for Windows 7, which contains the Kernel Debugger (KD))</li><li>Install LiveKD from the SysInternals Suite <ul><li><strong>IMPORTANT: the livekd.exe file should be placed in the system32
folder</strong></li></ul></li></ul><p>Notice that since we use LiveKD, we are essentially debugging the Kernel
locally without a second system. With this approach, functions cannot be
debugged as LiveKD uses a Kernel read-only memory dump as a basis.</p></div><div class=post-footer><a href=/posts/practical-reverse-engineering/2017-06-17-practical-reverse-engineering-exercise-solutions-windows-kernel-routines/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/practical-reverse-engineering/>Practical Reverse Engineering</a>,&nbsp;<a href=/tags/x64/>X64</a>,&nbsp;<a href=/tags/x86/>X86</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/web-app-sec/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss/>Cross-Site Scripting Attacks with adverse Conditions: Upper-Case XSS</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2017-04-05>2017-04-05</time></span>&nbsp;<span class=post-category>included in <a href=/categories/web-application-security/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web Application Security</a></span></div><div class=content><p>Several times I have encountered web applications that convert
user-provided input to capital letters. For example, the application may
behave as follows:</p><p><a href=../images/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png rel><img class=lazyload src=/svg/loading.min.svg data-src=../images/thumbnails/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png data-srcset="../images/thumbnails/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png, ../images/thumbnails/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png 1.5x, ../images/thumbnails/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png 2x" data-sizes=auto alt=../images/thumbnails/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png title=../images/thumbnails/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss-up1.png></a></p><p>The injected JavaScript code (after escaping from the quotes, of course) will not be executed in the browser. Why is this the case? Remember that the HTML tag names themselves, including <code>&lt;SCRIPT></code> are not case-sensitive, whereas the contents inside them are in fact case-sensitive.</p></div><div class=post-footer><a href=/posts/web-app-sec/2017-04-05-cross-site-scripting-attacks-with-adverse-conditions-upper-case-xss/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/xss/>XSS</a>,&nbsp;<a href=/tags/cross-site-scripting/>Cross-Site Scripting</a>,&nbsp;<a href=/tags/web-application-security/>Web Application Security</a>,&nbsp;<a href=/tags/upper-case/>Upper Case</a></div></div></article><ul class=pagination><li class=page-item><span class=page-link><a href=/>1</a></span></li><li class=page-item><span class=page-link aria-hidden=true>&mldr;</span></li><li class=page-item><span class=page-link><a href=/page/4/>4</a></span></li><li class=page-item><span class=page-link><a href=/page/5/>5</a></span></li><li class="page-item active"><span class=page-link><a href=/page/6/>6</a></span></li></ul></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e3},data:{"id-1":"Another blog about software security issues"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"]},duration:-1,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>