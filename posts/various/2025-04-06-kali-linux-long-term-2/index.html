<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space - soffensive blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/"><meta property="og:site_name" content="soffensive blog"><meta property="og:title" content="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space"><meta property="og:description" content="I am using Kali Linux on a regular basis inside a virtual machine (VirtualBox) and I have maintained my image for a couple of years.
Over the last months and years, the booting time got worse and worse, until it reached the following startup time:
1 2 3 └─$ systemd-analyze time Startup finished in 34.355s (kernel) + 1min 42.261s (userspace) = 2min 16.617s graphical.target reached after 1min 42.261s in userspace. In the first part of the series, we covered some optimizations with regard to disk usage. In this part, we want to determine why the system takes so much time to start up, even though it has sufficient hardware resources."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-06T19:27:16+02:00"><meta property="article:modified_time" content="2025-04-06T19:27:16+02:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Kali"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space"><meta name=twitter:description content="I am using Kali Linux on a regular basis inside a virtual machine (VirtualBox) and I have maintained my image for a couple of years.
Over the last months and years, the booting time got worse and worse, until it reached the following startup time:
1 2 3 └─$ systemd-analyze time Startup finished in 34.355s (kernel) + 1min 42.261s (userspace) = 2min 16.617s graphical.target reached after 1min 42.261s in userspace. In the first part of the series, we covered some optimizations with regard to disk usage. In this part, we want to determine why the system takes so much time to start up, even though it has sufficient hardware resources."><meta name=twitter:site content="@evisneffos"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/><link rel=prev href=https://soffensive.github.io/posts/various/2024-12-26-make-and-makefile-security/><link rel=next href=https://soffensive.github.io/posts/various/2025-04-13-kali-linux-long-term-3/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/soffensive.github.io\/posts\/various\/2025-04-06-kali-linux-long-term-2\/"},"genre":"posts","keywords":"Linux, Kali","wordcount":1354,"url":"https:\/\/soffensive.github.io\/posts\/various\/2025-04-06-kali-linux-long-term-2\/","datePublished":"2025-04-06T19:27:16+02:00","dateModified":"2025-04-06T19:27:16+02:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"soffensive"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-category>included in <a href=/categories/linux/><i class="far fa-folder fa-fw" aria-hidden=true></i>Linux</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-04-06>2025-04-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1354 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;7 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#journalctl-to-the-rescue>Journalctl to the Rescue</a></li><li><a href=#systemd-timeouts>Systemd Timeouts</a></li><li><a href=#the-swap-problem>The Swap Problem</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>I am using Kali Linux on a regular basis inside a virtual machine (VirtualBox) and I have maintained my image for a couple of years.</p><p>Over the last months and years, the booting time got worse and worse, until it reached the following startup time:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ systemd-analyze <span class=nb>time</span>                                                           
</span></span><span class=line><span class=cl>Startup finished in 34.355s <span class=o>(</span>kernel<span class=o>)</span> + 1min 42.261s <span class=o>(</span>userspace<span class=o>)</span> <span class=o>=</span> 2min 16.617s 
</span></span><span class=line><span class=cl>graphical.target reached after 1min 42.261s in userspace.
</span></span></code></pre></td></tr></table></div></div><p>In the first part of the series, we covered some optimizations with regard to disk usage. In this part, we want to determine why the system takes so much time to start up, even though it has sufficient hardware resources.</p><h3 id=journalctl-to-the-rescue>Journalctl to the Rescue</h3><p>A good start is the <code>journalctl</code> command, which will print log entries from the systemd journal.
The systemd journal logs detailed startup events, including timeouts and failures.</p><p>Since we are interested in the boot process, we can look for potential errors and timeouts with the following command, which shows only messages for the current boot:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$  journalctl -b
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Apr <span class=m>05</span> 17:26:00 kalipen kernel: Linux version 6.12.20-amd64 <span class=o>(</span>devel@kali.org<span class=o>)</span> <span class=o>(</span>x86_64-linux-gnu-gcc-14 <span class=o>(</span>Debian 14.2.0-19<span class=o>)</span> 14.2.0, GNU ld <span class=o>(</span>GNU Binutils <span class=k>for</span> Debian<span class=o>)</span> 2.44<span class=o>)</span> <span class=c1>#1 SMP PREEMPT_DYNAMIC Kali 6.12.20-1kali1 (2025-03-26)</span>
</span></span><span class=line><span class=cl>Apr <span class=m>05</span> 17:26:00 kalipen kernel: Command line: <span class=nv>BOOT_IMAGE</span><span class=o>=</span>/boot/vmlinuz-6.12.20-amd64 <span class=nv>root</span><span class=o>=</span><span class=nv>UUID</span><span class=o>=</span>dad034ac-b23b-466f-9402-cd385b400121 ro <span class=nv>initrd</span><span class=o>=</span>/install/initrd.gz quiet splash
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>The output can be overwhelming, so we refine our search by looking at higher priority events only:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>journalctl -b -p <span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>-p 3: Shows priority level 3 (errors) and above, often highlighting startup failures.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ sudo journalctl -b -p <span class=m>3</span>                                                        
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl>Apr <span class=m>05</span> 17:27:35 kalipen systemd<span class=o>[</span>1<span class=o>]</span>: Timed out waiting <span class=k>for</span> device dev-disk-by<span class=se>\x</span>2duuid-8191879a<span class=se>\x</span>2df03c<span class=se>\x</span>2d4f6c<span class=se>\x</span>2d9d59<span class=se>\x</span>2dc217cfca09ab.device - /dev/disk/by-uuid/8191879a-f03c-4f6c-9d59-c217cfca09ab.
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>This is already a promising hint: systemd waits for a certain disk or device. What is going on here?</p><h3 id=systemd-timeouts>Systemd Timeouts</h3><p>First of all, we note that it takes over 90 seconds for systemd to time out (note the timestamps from above, which start at 17:26:00, whereas the systemd error message shows up only at 17:27:35). Let us examine the timeout values configured for systemd:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ grep -i timeout /etc/systemd/system.conf                                                                                                                          
</span></span><span class=line><span class=cl><span class=c1>#DefaultTimeoutStartSec=90s</span>
</span></span><span class=line><span class=cl><span class=c1>#DefaultTimeoutStopSec=90s</span>
</span></span><span class=line><span class=cl><span class=c1>#DefaultTimeoutAbortSec=</span>
</span></span><span class=line><span class=cl><span class=c1>#DefaultDeviceTimeoutSec=90s</span>
</span></span></code></pre></td></tr></table></div></div><p>Since no timeout value is configured, systemd’s built-in default is 90 seconds (1min 30s), as per the systemd-system.conf man page.</p><p>The <em>DefaultTimeoutStartSec</em> configuration in systemd sets the default time limit that systemd will wait for a service to start before considering it failed.</p><p>Let us configure now a shorter timeout value for both <em>DefaultDeviceTimeoutSec</em>, which configures the default timeout for waiting for devices, and <em>DefaultTimeoutStartSec</em>. Note that this will not fix the underlying problem, but maybe it will reduce the boot loading time a bit.</p><p>To make it more uniform, we apply the same value (10 seconds) to the <em>DefaultTimeoutStopSec</em> setting as well:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ grep -i timeout /etc/systemd/system.conf                                       
</span></span><span class=line><span class=cl><span class=nv>DefaultTimeoutStartSec</span><span class=o>=</span>10s
</span></span><span class=line><span class=cl><span class=nv>DefaultTimeoutStopSec</span><span class=o>=</span>10s
</span></span><span class=line><span class=cl><span class=c1>#DefaultTimeoutAbortSec=</span>
</span></span><span class=line><span class=cl><span class=nv>DefaultDeviceTimeoutSec</span><span class=o>=</span>10s
</span></span></code></pre></td></tr></table></div></div><p>After rebooting, we check the results again:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ systemd-analyze <span class=nb>time</span>             
</span></span><span class=line><span class=cl>Startup finished in 35.915s <span class=o>(</span>kernel<span class=o>)</span> + 27.617s <span class=o>(</span>userspace<span class=o>)</span> <span class=o>=</span> 1min 3.532s 
</span></span><span class=line><span class=cl>graphical.target reached after 27.616s in userspace.
</span></span></code></pre></td></tr></table></div></div><p>Success! We reduced our system startup time from 2 minutes 16 seconds to 1 minute 3 seconds, a reduction of more than 50%.</p><h3 id=the-swap-problem>The Swap Problem</h3><p>Let us now check <code>/etc/fstab</code> for configured disk devices:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ cat /etc/fstab  
</span></span><span class=line><span class=cl><span class=c1># /etc/fstab: static file system information.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Use &#39;blkid&#39; to print the universally unique identifier for a</span>
</span></span><span class=line><span class=cl><span class=c1># device; this may be used with UUID= as a more robust way to name devices</span>
</span></span><span class=line><span class=cl><span class=c1># that works even if disks are added and removed. See fstab(5).</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># / was on /dev/sda1 during installation</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>dad034ac-b23b-466f-9402-cd385b400121 /               ext4    <span class=nv>errors</span><span class=o>=</span>remount-ro <span class=m>0</span>       <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># swap was on /dev/sda5 during installation</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>8191879a-f03c-4f6c-9d59-c217cfca09ab none            swap    sw              <span class=m>0</span>       <span class=m>0</span>
</span></span><span class=line><span class=cl>/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     <span class=m>0</span>       <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p>Here we see also the UUID of the device that systemd is waiting for:
<code>UUID=8191879a-f03c-4f6c-9d59-c217cfca09ab</code></p><p>This disk is supposed to serve as a swap partition. We continue to inspect the available disks and disk IDs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ lsblk         
</span></span><span class=line><span class=cl>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
</span></span><span class=line><span class=cl>sda      8:0    <span class=m>0</span> 144.1G  <span class=m>0</span> disk 
</span></span><span class=line><span class=cl>├─sda1   8:1    <span class=m>0</span> 142.1G  <span class=m>0</span> part /
</span></span><span class=line><span class=cl>└─sda2   8:2    <span class=m>0</span>     2G  <span class=m>0</span> part 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>└─$ blkid
</span></span><span class=line><span class=cl>/dev/sda2: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;a8f66941-83aa-465d-a649-5ad990d7a197&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;swap&#34;</span> <span class=nv>PARTUUID</span><span class=o>=</span><span class=s2>&#34;f831f204-02&#34;</span>
</span></span><span class=line><span class=cl>/dev/sda1: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;dad034ac-b23b-466f-9402-cd385b400121&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;4096&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;ext4&#34;</span> <span class=nv>PARTUUID</span><span class=o>=</span><span class=s2>&#34;f831f204-01&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>The UUID of the swap partition changed, but why? As it turns out, when you resize your disk, for example with GParted, the UUIDs change (see <a href=https://techlabs.blog/categories/debian-linux/expand-linux-virtual-machine-disk-partition-using-gparted%29 target=_blank rel="noopener noreffer">https://techlabs.blog/categories/debian-linux/expand-linux-virtual-machine-disk-partition-using-gparted)</a>.</p><p>Thus, the static references in <code>/etc/fstab</code> will not update and you have to adjust them manually.</p><p>This is described in detail on <a href=https://linux-blog.anracom.com/2020/11/15/long-boot-time-of-kali-linux-after-swap-partition-changes-swap-settings-for-the-initramfs/ target=_blank rel="noopener noreffer">https://linux-blog.anracom.com/2020/11/15/long-boot-time-of-kali-linux-after-swap-partition-changes-swap-settings-for-the-initramfs/</a>.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../longterm_gparted.png data-srcset="../longterm_gparted.png, ../longterm_gparted.png 1.5x, ../longterm_gparted.png 2x" data-sizes=auto alt=../longterm_gparted.png title="GParted Usage"></p><p>Thus, we have to make sure each time after resizing a disk that has swap partitions to update at least the following files:</p><ul><li><code>/etc/fstab</code></li><li><code>/etc/initramfs-tools/conf.d/resume</code> (this file is used when resuming from hibernation, and it can cause boot delays if we no longer have a swap partition, see <a href=https://www.linuxuprising.com/2018/08/how-to-use-swap-file-instead-of-swap.html target=_blank rel="noopener noreffer">https://www.linuxuprising.com/2018/08/how-to-use-swap-file-instead-of-swap.html</a>)</li><li><code>/etc/default/grub</code> (for Grub2 configuration)</li></ul><p>Back to our situation: Since we had originally configured a swap partition, but the swap partition UUID changed and it was not updated in <code>/etc/fstab</code> we currently do not have any swap space at all!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ free -h                      
</span></span><span class=line><span class=cl>               total        used        free      shared  buff/cache   available
</span></span><span class=line><span class=cl>Mem:            14Gi       1.2Gi        11Gi        40Mi       2.0Gi        13Gi
</span></span><span class=line><span class=cl>Swap:             0B          0B          0B
</span></span></code></pre></td></tr></table></div></div><p>Due to the lack of swap space, programs could fail or crash when they run out of memory. In our case it was not noticeable due to the large amount of available RAM. But there can be several problems:</p><ul><li>Programs may not run fully or crash when running of memory.</li><li>The system might crash completely when running out of physical RAM.</li><li>There may be a segmentation fault when writing to a page when there are no physical pages.</li></ul><p>In modern Linux kernel versions swap files are virtually as fast as swap partitions. Of course, the swap file should be contiguous to provide the same speed as a partition.
When using swap files instead of swap partitions, we also mitigate the problem of changing disk UUIDs.</p><p>First, let us create a swap file and use it in <code>/etc/fstab</code>. With a RAM size of 16 GB, we set the size of the swap file to 4 GB (see <a href=https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/managing_storage_devices/getting-started-with-swap_managing-storage-devices#overview-of-swap-space_getting-started-with-swap%29 target=_blank rel="noopener noreffer">https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/managing_storage_devices/getting-started-with-swap_managing-storage-devices#overview-of-swap-space_getting-started-with-swap)</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo fallocate -l 4G /swapfile
</span></span><span class=line><span class=cl>sudo chmod <span class=m>600</span> /swapfile
</span></span><span class=line><span class=cl>sudo mkswap /swapfile
</span></span><span class=line><span class=cl>sudo swapon /swapfile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;/swapfile none swap sw 0 0&#34;</span> <span class=p>|</span> sudo tee -a /etc/fstab
</span></span></code></pre></td></tr></table></div></div><p>We can immediately verify that our system has swap space again:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ free -h                                                                        
</span></span><span class=line><span class=cl>               total        used        free      shared  buff/cache   available
</span></span><span class=line><span class=cl>Mem:            14Gi       1.2Gi        11Gi        40Mi       2.0Gi        13Gi
</span></span><span class=line><span class=cl>Swap:          4.0Gi          0B       4.0Gi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>└─$ sudo swapon --show            
</span></span><span class=line><span class=cl>NAME      TYPE SIZE USED PRIO
</span></span><span class=line><span class=cl>/swapfile file   4G   0B   -2
</span></span></code></pre></td></tr></table></div></div><p>Secondly, we comment out the line in <code>/etc/fstab</code> with the swap partition:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># /etc/fstab: static file system information.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Use &#39;blkid&#39; to print the universally unique identifier for a</span>
</span></span><span class=line><span class=cl><span class=c1># device; this may be used with UUID= as a more robust way to name devices</span>
</span></span><span class=line><span class=cl><span class=c1># that works even if disks are added and removed. See fstab(5).</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># / was on /dev/sda1 during installation</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>dad034ac-b23b-466f-9402-cd385b400121 /               ext4    <span class=nv>errors</span><span class=o>=</span>remount-ro <span class=m>0</span>       <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=c1># swap was on /dev/sda5 during installation</span>
</span></span><span class=line><span class=cl><span class=c1>#UUID=8191879a-f03c-4f6c-9d59-c217cfca09ab none            swap    sw              0       0</span>
</span></span><span class=line><span class=cl>/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     <span class=m>0</span>       <span class=m>0</span>
</span></span><span class=line><span class=cl>/swapfile none swap sw <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p>After rebooting, we can notice another improvement in the system&rsquo;s startup time:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ systemd-analyze <span class=nb>time</span>  
</span></span><span class=line><span class=cl>Startup finished in 38.529s <span class=o>(</span>kernel<span class=o>)</span> + 13.637s <span class=o>(</span>userspace<span class=o>)</span> <span class=o>=</span> 52.167s 
</span></span><span class=line><span class=cl>graphical.target reached after 13.637s in userspace.
</span></span></code></pre></td></tr></table></div></div><p>Thirdly, we boot with a GParted ISO image, remove the swap partition entirely and reize our main partition <code>/dev/sda1</code>:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../longterm_delete_partition.png data-srcset="../longterm_delete_partition.png, ../longterm_delete_partition.png 1.5x, ../longterm_delete_partition.png 2x" data-sizes=auto alt=../longterm_delete_partition.png title="Delete Swap Partition"></p><p><img class=lazyload src=/svg/loading.min.svg data-src=../longterm_resize_partition.png data-srcset="../longterm_resize_partition.png, ../longterm_resize_partition.png 1.5x, ../longterm_resize_partition.png 2x" data-sizes=auto alt=../longterm_resize_partition.png title="Resize Main Partition"></p><p>Finally, we finish with a startup time of roughly 47 seconds. This is still a lot and we will tackle the underlying problems in the next blog post:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>└─$ systemd-analyze <span class=nb>time</span>          
</span></span><span class=line><span class=cl>Startup finished in 33.775s <span class=o>(</span>kernel<span class=o>)</span> + 13.879s <span class=o>(</span>userspace<span class=o>)</span> <span class=o>=</span> 47.655s 
</span></span><span class=line><span class=cl>graphical.target reached after 13.879s in userspace.
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-04-06</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/ data-title="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space" data-via=evisneffos data-hashtags=Linux,Kali><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/ data-hashtag=Linux><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/ data-title="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/ data-title="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/ data-title="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://soffensive.github.io/posts/various/2025-04-06-kali-linux-long-term-2/ data-title="Kali Linux Long Term Usage Part 2: Systemd, Partitions, and Swap Space"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/linux/>Linux</a>,&nbsp;<a href=/tags/kali/>Kali</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/various/2024-12-26-make-and-makefile-security/ class=prev rel=prev title="make and makefile"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>make and makefile</a>
<a href=/posts/various/2025-04-13-kali-linux-long-term-3/ class=next rel=next title="Kali Linux Long Term Usage Part 3: VirtualBox Guest Additions">Kali Linux Long Term Usage Part 3: VirtualBox Guest Additions<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.147.8">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e3},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>