<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems - soffensive blog</title><meta name="Description" content=""><meta property="og:title" content="Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems" />
<meta property="og:description" content="In a recent engagement I was confronted with a blind path traversal vulnerability on a server running with the Microsoft Windows operating system. That is, it was not possible to display folder contents but the complete file name and path had to be guessed. Due to the lack of a comprehensive website I was forced to gather information from various different sources.
In this blog post, I want to summarize my findings and focus on the exploitation of this kind of vulnerability." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-19T01:31:00-07:00" />
<meta property="article:modified_time" content="2018-06-19T01:31:00-07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems"/>
<meta name="twitter:description" content="In a recent engagement I was confronted with a blind path traversal vulnerability on a server running with the Microsoft Windows operating system. That is, it was not possible to display folder contents but the complete file name and path had to be guessed. Due to the lack of a comprehensive website I was forced to gather information from various different sources.
In this blog post, I want to summarize my findings and focus on the exploitation of this kind of vulnerability."/>
<meta name="application-name" content="soffensive blog">
<meta name="apple-mobile-web-app-title" content="soffensive blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/" /><link rel="prev" href="http://localhost:1313/posts/2018-04-23-exploiting-misconfigured-cors-null-origin/" /><link rel="next" href="http://localhost:1313/posts/2019-05-18-xxe-with-net-in-2019/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems\/"
        },"genre": "posts","keywords": "Web Application Security, blind file reads, path traversal, windows, XXE","wordcount":  781 ,
        "url": "http:\/\/localhost:1313\/posts\/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems\/","datePublished": "2018-06-19T01:31:00-07:00","dateModified": "2018-06-19T01:31:00-07:00","publisher": {
            "@type": "Organization",
            "name": "soffensive"},"author": {
                "@type": "Person",
                "name": "soffensive"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="soffensive blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>soffensive</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/soffensive" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><a class="menu-item" href="https://twitter.com/evisneffos" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="soffensive blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>soffensive</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/soffensive" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a class="menu-item" href="https://twitter.com/evisneffos" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>soffensive</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2018-06-19">2018-06-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;781 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#identifying-vulnerable-applications">Identifying vulnerable Applications</a></li>
        <li><a href="#determining-the-privilege-level-of-the-reading-process">Determining the Privilege Level of the reading Process</a></li>
        <li><a href="#determining-the-windows-version">Determining the Windows Version</a></li>
        <li><a href="#finetuning">Finetuning</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>In a recent engagement I was confronted with a blind path traversal vulnerability on a server running with the Microsoft Windows operating system. That is, it was not possible to display folder contents but the complete file name and path had to be guessed. Due to the lack of a comprehensive website I was forced to gather information from various different sources.</p>
<p>In this blog post, I want to summarize my findings and focus on the exploitation of  this kind of vulnerability.</p>
<p>Admittedly, vanilla path traversal vulnerabilities have become somewhat rare and Microsoft Windows as a server operating system is also more of an exception than the rule. However, in an XXE scenario, you may encounter a similar situation.</p>
<p>Also, this post will not shed light on the detection of this vulnerability - which is an art in itself and has already been thoroughly documented. In a nutshell, the key to the successful detection is to guess the correct path of a world-readable file (with the correct encoding).</p>
<h3 id="identifying-vulnerable-applications">Identifying vulnerable Applications</h3>
<p>On Microsoft Windows, the following files are good choices since they are present in almost every version:</p>
<p><code>c:\windows\system.ini</code><br>
<code>c:\windows\win.ini</code></p>
<p>Assuming you have successfully identified a path traversal vulnerability, the only question is how further it can be escalated. The major obstacle is that you usually have to know in advance the exact location of the files you want to read. As opposed to *nix-based operating systems, the locations can differ significantly from one Windows installation to another. For instance, the main system drive letter may not be <code>C:</code> or the user name may differ from the standard <code>Administrator</code>.</p>
<p>First and foremost, we have to recall a few key characteristics of Windows operating systems:</p>
<ul>
<li>Files and directories are handled <strong>case-insensitive</strong>: From an attacker perspective, our life will be easier since we only have to probe one variation of a given location. For example it suffices to test for <code>../../windows/win.ini</code> instead of attempting also <code>../../WINDOWS/win.ini</code>.</li>
<li>Forward and backward slashes can most of the times be used interchangeably; e.g., <code>../..\../windows/win.ini</code> is a valid file path in Windows.</li>
</ul>
<h3 id="determining-the-privilege-level-of-the-reading-process">Determining the Privilege Level of the reading Process</h3>
<p>In order to assess the severity of a path traversal bug, you should determine the privilege level of the process that peforms the file retrieval. From an attacker perspective, the process should ideally run with elevated privileges, i.e. by <code>LocalSystem </code>(= root equivalent) or by a member of the <code>Administrators </code>group.</p>
<p>If you can successfully retrieve one of the following files, you are at least a member of the Administrators group:</p>
<ul>
<li><code>c:/documents and settings/administrator/ntuser.ini</code></li>
<li><code>c:/documents and settings/administrator/desktop/desktop.ini</code></li>
<li><code>c:/users/administrator/desktop/desktop.ini</code></li>
<li><code>c:/users/administrator/ntuser.ini</code></li>
</ul>
<p>As already mentioned, there is a catch to this approach - there might be no such user account. In this case, you have to guess the name of an administrator account.</p>
<p>In contrast, the following files should be available on all modern Windows operating systems and are independent from the set up:</p>
<ul>
<li><code>c:/system volume information/wpsettings.dat</code></li>
<li><code>C:/Windows/CSC/v2.0.6/pq</code></li>
<li><code>C:/Windows/CSC/v2.0.6/sm</code></li>
<li><code>C:/$Recycle.Bin/S-1-5-18/desktop.ini</code></li>
</ul>
<p>If you can read either of these files, the file reading process has <code>LocalSystem </code>privileges.</p>
<h3 id="determining-the-windows-version">Determining the Windows Version</h3>
<p>Moreover, you should determine the exact version of Microsoft Windows. On Linux this is again far more simple, since we can read files such as the following:</p>
<ul>
<li><code>/etc/issue</code></li>
<li><code>/etc/*release</code></li>
<li><code>/proc/version</code></li>
</ul>
<p>Up until Windows 10, there is a similar file also containing version information, namely at</p>
<ul>
<li><code>c:/windows/system32/license.rtf</code></li>
</ul>
<p>It is also present on Windows 10, but it does not contain version information (which can also be used as a blind indicator). </p>
<p>The best way is, however, to retrieve a Microsoft-compiled executable from the target system and analyze the included version information in the <code>file properties</code> tab.  Possible candidates are:</p>
<ul>
<li><code>c:/windows/explorer.exe</code></li>
<li><code>c:/windows/notepad.exe</code></li>
<li><code>c:/windows/system32/ntoskrnl.exe</code></li>
</ul>
<p>Afterwards, you can consulting the following table for looking up the corresponding operating system version:</p>
<ul>
<li><code>10.0 = Windows 10 / Windows Server 2016</code></li>
<li><code>6.3 = Windows 8.1 / Windows Server 2012 R2</code></li>
<li><code>6.2 = Windows 8 / Windows Server 2012</code></li>
<li><code>6.1 = Windows 7 / Windows Server 2008 R2</code></li>
<li><code>6.0 = Windows Vista / Windows Server 2008</code></li>
<li><code>5.2 = Windows XP 64 Bit / Windows Server 2003</code></li>
<li><code>5.1 = Windows XP</code></li>
<li><code>5.0 = Windows 2000</code></li>
<li><code>4.0 = Windows NT 4</code></li>
</ul>
<p>Instead of the file properties tab, you can also use the <a href="https://github.com/erocarrera/pefile" target="_blank" rel="noopener noreffer">peinfo</a> package for Python to analyze the version number as follows:</p>
<h3 id="finetuning">Finetuning</h3>
<p>To exploit the full potential of the path traversal vulnerability, you will likely have to perform an educated brute-force or dictionary attack, as the <em>interesting</em> files are technology-dependent.</p>
<p>The following list may be helpful as a first step and I would appreciate any additions or comments to this list:</p>
<p><a href="https://github.com/soffensive/windowsblindread">https://github.com/soffensive/windowsblindread</a></p>
<p>References and follow-up links:</p>
<p>Web Application Hacker&rsquo;s Handbook, 2nd Edition<br>
 <a href="https://www.owasp.org/index.php/Testing_Directory_traversal/file_include_(OTG-AUTHZ-001)">https://www.owasp.org/index.php/Testing_Directory_traversal/file_include_(OTG-AUTHZ-001)</a><br>
<a href="https://github.com/mubix/post-exploitation-wiki/blob/master/windows/files.md">https://github.com/mubix/post-exploitation-wiki/blob/master/windows/files.md</a><br>
<a href="http://pwnwiki.io/#!presence/windows/blind.md">http://pwnwiki.io/#!presence/windows/blind.md</a><br>
<a href="https://blog.netspi.com/smb-attacks-through-directory-traversal/">https://blog.netspi.com/smb-attacks-through-directory-traversal/</a><br>
<a href="https://digi.ninja/blog/when_all_you_can_do_is_read.php">https://digi.ninja/blog/when_all_you_can_do_is_read.php</a><br>
<a href="https://superuser.com/questions/363018/how-do-i-tell-what-version-and-edition-of-windows-is-on-the-filesystem">https://superuser.com/questions/363018/how-do-i-tell-what-version-and-edition-of-windows-is-on-the-filesystem</a><br>
<a href="https://docs.microsoft.com/en-us/windows/desktop/sysinfo/operating-system-version">https://docs.microsoft.com/en-us/windows/desktop/sysinfo/operating-system-version</a><br>
<a href="https://docs.microsoft.com/en-us/windows/desktop/api/verrsrc/ns-verrsrc-tagvs_fixedfileinfo">https://docs.microsoft.com/en-us/windows/desktop/api/verrsrc/ns-verrsrc-tagvs_fixedfileinfo</a><br>
<a href="https://stackoverflow.com/questions/1264472/using-the-pefile-py-to-get-file-exe-version">https://stackoverflow.com/questions/1264472/using-the-pefile-py-to-get-file-exe-version</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2018-06-19</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/" data-title="Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems" data-via="evisneffos" data-hashtags="Web Application Security,blind file reads,path traversal,windows,XXE"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/" data-hashtag="Web Application Security"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/posts/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://localhost:1313/posts/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/" data-title="Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems" data-web><i class="fab fa-whatsapp fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/web-application-security/">Web Application Security</a>,&nbsp;<a href="/tags/blind-file-reads/">blind file reads</a>,&nbsp;<a href="/tags/path-traversal/">path traversal</a>,&nbsp;<a href="/tags/windows/">windows</a>,&nbsp;<a href="/tags/xxe/">XXE</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2018-04-23-exploiting-misconfigured-cors-null-origin/" class="prev" rel="prev" title="Exploiting misconfigured CORS Null Origin"><i class="fas fa-angle-left fa-fw"></i>Exploiting misconfigured CORS Null Origin</a>
            <a href="/posts/2019-05-18-xxe-with-net-in-2019/" class="next" rel="next" title="XXE with .NET in 2019">XXE with .NET in 2019<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2017 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":1000},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
