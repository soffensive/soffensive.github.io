<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3 - soffensive blog</title><meta name="Description" content=""><meta property="og:title" content="Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3" />
<meta property="og:description" content="Exercise 3 on page 79 of the book Practical Reverse Engineering specifies the following ARM disassembly of a function mystery3:
1 2 3 4 5 6 7 8  01: mystery3 02: 83 68 LDR R3, [R0,#8] 03: 0B 60 STR R3, [R1] 04: C3 68 LDR R3, [R0,#0xC] 05: 00 20 MOVS R0, #0 06: 4B 60 STR R3, [R1,#4] 07: 70 47 BX LR 08: ; End of function mystery3   It is provided in Thumb mode, as we can see from the instruction width, which is consistently 16 bits." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-02T05:20:00-08:00" />
<meta property="article:modified_time" content="2017-12-02T05:20:00-08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3"/>
<meta name="twitter:description" content="Exercise 3 on page 79 of the book Practical Reverse Engineering specifies the following ARM disassembly of a function mystery3:
1 2 3 4 5 6 7 8  01: mystery3 02: 83 68 LDR R3, [R0,#8] 03: 0B 60 STR R3, [R1] 04: C3 68 LDR R3, [R0,#0xC] 05: 00 20 MOVS R0, #0 06: 4B 60 STR R3, [R1,#4] 07: 70 47 BX LR 08: ; End of function mystery3   It is provided in Thumb mode, as we can see from the instruction width, which is consistently 16 bits."/>
<meta name="application-name" content="soffensive blog">
<meta name="apple-mobile-web-app-title" content="soffensive blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3/" /><link rel="prev" href="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-78-exercise-2/" /><link rel="next" href="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-4/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/practical-reverse-engineering\/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3\/"
        },"genre": "posts","keywords": "ARM, Practical Reverse Engineering","wordcount":  261 ,
        "url": "http:\/\/localhost:1313\/posts\/practical-reverse-engineering\/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3\/","datePublished": "2017-12-02T05:20:00-08:00","dateModified": "2017-12-02T05:20:00-08:00","publisher": {
            "@type": "Organization",
            "name": "soffensive"},"author": {
                "@type": "Person",
                "name": "soffensive"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="soffensive blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>soffensive</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/soffensive" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><a class="menu-item" href="https://twitter.com/evisneffos" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="soffensive blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>soffensive</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/soffensive" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a class="menu-item" href="https://twitter.com/evisneffos" title="Twitter" rel="noopener noreffer" target="_blank"><i class='fab fa-twitter fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>soffensive</a></span>&nbsp;<span class="post-category">included in <a href="/categories/practical-reverse-engineering/"><i class="far fa-folder fa-fw"></i>practical reverse engineering</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2017-12-02">2017-12-02</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;261 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents"></nav></div>
            </div><div class="content" id="content"><p>Exercise 3 on page 79 of the book Practical Reverse Engineering specifies the following ARM disassembly of a function <code>mystery3</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-nasm" data-lang="nasm"><span class="err">01:</span>             <span class="nf">mystery3</span>
<span class="err">02:</span> <span class="err">83</span> <span class="err">68</span>         <span class="nf">LDR</span>             <span class="nv">R3</span><span class="p">,</span> <span class="p">[</span><span class="nv">R0</span><span class="p">,</span><span class="err">#</span><span class="mi">8</span><span class="p">]</span>
<span class="err">03:</span> <span class="err">0</span><span class="nf">B</span> <span class="mi">60</span>         <span class="nv">STR</span>             <span class="nv">R3</span><span class="p">,</span> <span class="p">[</span><span class="nv">R1</span><span class="p">]</span>
<span class="err">04:</span> <span class="nf">C3</span> <span class="mi">68</span>         <span class="nv">LDR</span>             <span class="nv">R3</span><span class="p">,</span> <span class="p">[</span><span class="nv">R0</span><span class="p">,</span><span class="err">#</span><span class="mh">0xC</span><span class="p">]</span>
<span class="err">05:</span> <span class="err">00</span> <span class="err">20</span>         <span class="nf">MOVS</span>            <span class="nv">R0</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span>
<span class="err">06:</span> <span class="err">4</span><span class="nf">B</span> <span class="mi">60</span>         <span class="nv">STR</span>             <span class="nv">R3</span><span class="p">,</span> <span class="p">[</span><span class="nv">R1</span><span class="p">,</span><span class="err">#</span><span class="mi">4</span><span class="p">]</span>
<span class="err">07:</span> <span class="err">70</span> <span class="err">47</span>         <span class="nf">BX</span>              <span class="nv">LR</span>
<span class="err">08:</span>             <span class="c1">; End of function mystery3</span>
</code></pre></td></tr></table>
</div>
</div><p>It is provided in Thumb mode, as we can see from the instruction width, which is consistently 16 bits. Furthermore, the decompilation is greatly facilitated thanks to the lack of any conditional statements. Any kind of NULL-checks, for instance, are omitted.</p>
<p>The function mystery3 takes two arguments in <code>r0</code> and <code>r1</code>, as these registers are accessed without prior initialization. Both arguments are pointers to some unknown structure, as they are accessed in memory load and store operations with different offsets. The return value is always 0, as 0 is put into register r0 before exiting. Thus far, we arrive at the following function prototype:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">BOOL</span> <span class="nf">mystery3</span> <span class="p">(</span><span class="n">struct1</span><span class="o">*</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">struct2</span><span class="o">*</span> <span class="n">arg2</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>As far as the data types of the arguments are concerned, we can make the following statements about their composition:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="nl">struct1</span><span class="p">:</span>
 <span class="n">field08_i</span> <span class="c1">//32 bit value
</span><span class="c1"></span> <span class="n">field0C_i</span> <span class="c1">//32 bit value
</span><span class="c1"></span>
<span class="nl">struct2</span><span class="p">:</span>
 <span class="n">field00_i</span> <span class="c1">//32 bit value
</span><span class="c1"></span> <span class="n">field04_i</span> <span class="c1">//32 bit value
</span></code></pre></td></tr></table>
</div>
</div><p>The function copies values of the first argument&rsquo;s structure into the second element&rsquo;s structure:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">BOOL</span> <span class="nf">copyFirstToSecond</span><span class="p">(</span><span class="n">struct1</span><span class="o">*</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">struct2</span><span class="o">*</span> <span class="n">arg2</span><span class="p">)</span> <span class="p">{</span>
 <span class="n">arg2</span><span class="o">-&gt;</span><span class="n">field00</span>  <span class="o">=</span> <span class="n">arg1</span><span class="o">-&gt;</span><span class="n">field08</span><span class="p">;</span>
 <span class="n">arg2</span><span class="o">-&gt;</span><span class="n">field04</span> <span class="o">=</span> <span class="n">arg1</span><span class="o">-&gt;</span><span class="n">field0C</span><span class="p">;</span>
 <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2017-12-02</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3/" data-title="Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3" data-via="evisneffos" data-hashtags="ARM,Practical Reverse Engineering"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3/" data-hashtag="ARM"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://localhost:1313/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-3/" data-title="Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 3" data-web><i class="fab fa-whatsapp fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/arm/">ARM</a>,&nbsp;<a href="/tags/practical-reverse-engineering/">Practical Reverse Engineering</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-78-exercise-2/" class="prev" rel="prev" title="Practical Reverse Engineering Exercise Solutions: Page 78 / Exercise 2"><i class="fas fa-angle-left fa-fw"></i>Practical Reverse Engineering Exercise Solutions: Page 78 / Exercise 2</a>
            <a href="/posts/practical-reverse-engineering/2017-12-02-practical-reverse-engineering-exercise-solutions-page-79-exercise-4/" class="next" rel="next" title="Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 4">Practical Reverse Engineering Exercise Solutions: Page 79 / Exercise 4<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2017 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":1000},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
