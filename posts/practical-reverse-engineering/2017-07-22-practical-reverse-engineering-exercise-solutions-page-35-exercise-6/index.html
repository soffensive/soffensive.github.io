<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6 - soffensive blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/">
<meta property="og:site_name" content="soffensive blog"><meta property="og:title" content="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6"><meta property="og:description" content="Exercise 6 on page 35 of the book Practical Reverse Engineering presents us with a malware samples.
These can be downloaded at the following page:
https://grsecurity.net/malware_research/
In this exercise, we are expected to have a look at the following routine sub_13842:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 .text:00013842 sub_13842 .text:00013842 mov eax, [ecx+60h] .text:00013845 push esi .text:00013846 mov esi, [edx+8] .text:00013849 dec byte ptr [ecx+23h] .text:0001384C sub eax, 24h .text:0001384F mov [ecx+60h], eax .text:00013852 mov [eax+14h], edx .text:00013855 movzx eax, byte ptr [eax] .text:00013858 push ecx .text:00013859 push edx .text:0001385A call dword ptr [esi+eax*4+38h] .text:0001385E pop esi .text:0001385F retn Firstly, we see that the function prototype takes two parameters, which are not saved on the stack but in the two registers ecx and edx. This can be deducted from the fact that these two registers are immediately referenced without prior initialization."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-07-22T23:49:00-07:00"><meta property="article:modified_time" content="2017-07-22T23:49:00-07:00"><meta property="article:tag" content="Practical Reverse Engineering"><meta property="article:tag" content="X64"><meta property="article:tag" content="X86"><meta name=twitter:card content="summary"><meta name=twitter:title content="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6"><meta name=twitter:description content="Exercise 6 on page 35 of the book Practical Reverse Engineering presents us with a malware samples.
These can be downloaded at the following page:
https://grsecurity.net/malware_research/
In this exercise, we are expected to have a look at the following routine sub_13842:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 .text:00013842 sub_13842 .text:00013842 mov eax, [ecx+60h] .text:00013845 push esi .text:00013846 mov esi, [edx+8] .text:00013849 dec byte ptr [ecx+23h] .text:0001384C sub eax, 24h .text:0001384F mov [ecx+60h], eax .text:00013852 mov [eax+14h], edx .text:00013855 movzx eax, byte ptr [eax] .text:00013858 push ecx .text:00013859 push edx .text:0001385A call dword ptr [esi+eax*4+38h] .text:0001385E pop esi .text:0001385F retn Firstly, we see that the function prototype takes two parameters, which are not saved on the stack but in the two registers ecx and edx. This can be deducted from the fact that these two registers are immediately referenced without prior initialization."><meta name=twitter:site content="@evisneffos"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/><link rel=prev href=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-16-practical-reverse-engineering-exercise-solutions-rtlvalidateunicodestring/><link rel=next href=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-30-practical-reverse-engineering-exercise-solutions-page-35-exercise-7/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/soffensive.github.io\/posts\/practical-reverse-engineering\/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6\/"},"genre":"posts","keywords":"Practical Reverse Engineering, x64, x86","wordcount":441,"url":"https:\/\/soffensive.github.io\/posts\/practical-reverse-engineering\/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6\/","datePublished":"2017-07-22T23:49:00-07:00","dateModified":"2017-07-22T23:49:00-07:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"soffensive"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-category>included in <a href=/categories/practical-reverse-engineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Practical Reverse Engineering</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2017-07-22>2017-07-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;441 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><p>Exercise 6 on page 35 of the book Practical Reverse Engineering presents us with a malware samples.</p><p>These can be downloaded at the following page:</p><p><a href=https://grsecurity.net/malware_research/ target=_blank rel="noopener noreffer">https://grsecurity.net/malware_research/</a></p><p>In this exercise, we are expected to have a look at the following routine <code>sub_13842</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013842</span> <span class=nf>sub_13842</span>      
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013842</span>                 <span class=nf>mov</span>     <span class=nb>eax</span><span class=p>,</span> <span class=p>[</span><span class=nb>ecx</span><span class=o>+</span><span class=mh>60h</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013845</span>                 <span class=nf>push</span>    <span class=nb>esi</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013846</span>                 <span class=nf>mov</span>     <span class=nb>esi</span><span class=p>,</span> <span class=p>[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013849</span>                 <span class=nf>dec</span>     <span class=kt>byte</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ecx</span><span class=o>+</span><span class=mh>23h</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>0001384</span><span class=nf>C</span>                 <span class=nv>sub</span>     <span class=nb>eax</span><span class=p>,</span> <span class=mh>24h</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>0001384</span><span class=nf>F</span>                 <span class=nv>mov</span>     <span class=p>[</span><span class=nb>ecx</span><span class=o>+</span><span class=mh>60h</span><span class=p>],</span> <span class=nb>eax</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013852</span>                 <span class=nf>mov</span>     <span class=p>[</span><span class=nb>eax</span><span class=o>+</span><span class=mh>14h</span><span class=p>],</span> <span class=nb>edx</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013855</span>                 <span class=nf>movzx</span>   <span class=nb>eax</span><span class=p>,</span> <span class=kt>byte</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>eax</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013858</span>                 <span class=nf>push</span>    <span class=nb>ecx</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>00013859</span>                 <span class=nf>push</span>    <span class=nb>edx</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>0001385</span><span class=nf>A</span>                 <span class=nv>call</span>    <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>esi</span><span class=o>+</span><span class=nb>eax</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=mh>38h</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>0001385</span><span class=nf>E</span>                 <span class=nv>pop</span>     <span class=nb>esi</span>
</span></span><span class=line><span class=cl><span class=nl>.text:</span><span class=err>0001385</span><span class=nf>F</span>                 <span class=nv>retn</span>
</span></span></code></pre></td></tr></table></div></div><p>Firstly, we see that the function prototype takes two parameters, which are not saved on the stack but in the two registers <code>ecx</code> and <code>edx</code>. This can be deducted from the fact that these two registers are immediately referenced without prior initialization.</p><p>On a very high abstraction level, the function prototype looks as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_13842</span><span class=p>(</span><span class=n>struct1</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=n>struct2</span><span class=o>*</span> <span class=n>b</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Moreover, we see that <code>edx+8</code> points to some kind of base address, as it is used to compute the address of the function called on the following line:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nl>.text:</span><span class=err>0001385</span><span class=nf>A</span>                 <span class=nv>call</span>    <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>esi</span><span class=o>+</span><span class=nb>eax</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=mh>38h</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>Both parameters <code>edx</code> and <code>ecx</code> obviously point to some kind of data structure, whose contents we are about to reveal:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nasm data-lang=nasm><span class=line><span class=cl><span class=nl>struct1:</span> 
</span></span><span class=line><span class=cl><span class=nf>offset</span><span class=o>+</span><span class=mi>60</span><span class=p>:</span> <span class=nv>struct3</span><span class=o>*</span><span class=p>:</span> <span class=nv>s3</span>
</span></span><span class=line><span class=cl><span class=nf>offset</span><span class=o>+</span><span class=mi>23</span><span class=p>:</span> <span class=nb>ch</span><span class=nv>ar</span><span class=p>:</span> <span class=nv>unknown0x23</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>struct2:</span>
</span></span><span class=line><span class=cl><span class=nf>offset</span><span class=o>+</span><span class=mi>08</span><span class=p>:</span> <span class=nv>void</span><span class=o>*</span><span class=p>:</span> <span class=nv>here</span> <span class=nv>we</span> <span class=nv>have</span> <span class=nv>some</span> <span class=nv>kind</span> <span class=nv>of</span> <span class=nv>trampoline</span> <span class=o>/</span> <span class=nv>array</span> <span class=nv>of</span> <span class=nv>function</span> <span class=nv>pointers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>struct3:</span>
</span></span><span class=line><span class=cl><span class=nf>offset</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span> <span class=nb>ch</span><span class=nv>ar</span><span class=p>:</span> <span class=nv>index</span>
</span></span><span class=line><span class=cl><span class=nf>offset</span><span class=o>+</span><span class=mi>14</span><span class=p>:</span> <span class=nv>struct2</span><span class=o>*</span><span class=p>:</span> <span class=nv>s2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>struct4:</span>
</span></span><span class=line><span class=cl><span class=nf>offset</span><span class=o>+</span><span class=mi>38</span><span class=p>:</span> <span class=nv>int</span><span class=o>*</span><span class=p>:</span> <span class=nv>unknown</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>sub_13842</span><span class=p>(</span><span class=nv>struct1</span><span class=o>*</span> <span class=nv>a</span><span class=p>,</span> <span class=nv>struct2</span><span class=o>*</span> <span class=nv>b</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013842</span> <span class=nf>sub_13842</span>      
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013842</span>                 <span class=nf>mov</span>     <span class=nb>eax</span><span class=p>,</span> <span class=kt>dword</span> <span class=nv>ptr</span><span class=p>[</span><span class=nb>ecx</span><span class=o>+</span><span class=mh>60h</span><span class=p>]</span> <span class=o>//</span> <span class=nv>struct3</span><span class=o>*</span> <span class=nv>v1</span> <span class=err>=</span> <span class=nv>a</span><span class=o>-&gt;</span><span class=nv>s3</span><span class=c1>;</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013845</span>                 <span class=nf>push</span>    <span class=nb>esi</span> <span class=o>//</span> <span class=nv>just</span> <span class=nv>save</span> <span class=nb>esi</span> <span class=nv>register</span> <span class=nv>value</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013846</span>                 <span class=nf>mov</span>     <span class=nb>esi</span><span class=p>,</span> <span class=p>[</span><span class=nb>edx</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=o>//</span> <span class=nv>void</span><span class=o>*</span> <span class=nv>v2</span> <span class=err>=</span> <span class=nv>b</span><span class=o>-&gt;</span><span class=nv>unknown0x8</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013849</span>                 <span class=nf>dec</span>     <span class=kt>byte</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>ecx</span><span class=o>+</span><span class=mh>23h</span><span class=p>]</span> <span class=o>//</span> <span class=nv>a</span><span class=o>-&gt;</span><span class=nv>unknown0x23</span> <span class=err>=</span> <span class=nv>a</span><span class=o>-&gt;</span><span class=nv>unknown0x23</span> <span class=o>-</span> <span class=mi>1</span><span class=c1>;</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>0001384</span><span class=nf>C</span>                 <span class=nv>sub</span>     <span class=nb>eax</span><span class=p>,</span> <span class=mh>24h</span> <span class=o>//</span> <span class=nv>v1</span> <span class=err>=</span> <span class=nv>v1</span> <span class=o>-</span> <span class=mh>0x24</span><span class=c1>;</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>0001384</span><span class=nf>F</span>                 <span class=nv>mov</span>     <span class=p>[</span><span class=nb>ecx</span><span class=o>+</span><span class=mh>60h</span><span class=p>],</span> <span class=nb>eax</span> <span class=o>//</span> <span class=nv>a</span><span class=o>-&gt;</span><span class=nv>s3</span> <span class=err>=</span> <span class=nv>v1</span><span class=c1>;</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013852</span>                 <span class=nf>mov</span>     <span class=p>[</span><span class=nb>eax</span><span class=o>+</span><span class=mh>14h</span><span class=p>],</span> <span class=nb>edx</span> <span class=o>//</span> <span class=nv>v1</span><span class=o>-&gt;</span><span class=nv>s2</span> <span class=err>=</span> <span class=nv>b</span><span class=c1>;</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013855</span>                 <span class=nf>movzx</span>   <span class=nb>eax</span><span class=p>,</span> <span class=kt>byte</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>eax</span><span class=p>]</span> <span class=o>//</span> <span class=nb>ch</span><span class=nv>ar</span> <span class=nv>index</span> <span class=err>=</span> <span class=nv>v1</span><span class=o>-&gt;</span><span class=nv>index</span><span class=c1>;</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013858</span>                 <span class=nf>push</span>    <span class=nb>ecx</span> 
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>00013859</span>                 <span class=nf>push</span>    <span class=nb>edx</span> <span class=o>//</span> <span class=nv>call</span> <span class=nv>fct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>0001385</span><span class=nf>A</span>                 <span class=nv>call</span>    <span class=kt>dword</span> <span class=nv>ptr</span> <span class=p>[</span><span class=nb>esi</span><span class=o>+</span><span class=nb>eax</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=mh>38h</span><span class=p>]</span> <span class=o>//</span> <span class=nv>call</span> <span class=nv>b</span><span class=o>-&gt;</span><span class=nv>unknown0x8</span><span class=o>+</span><span class=mh>0x38</span><span class=nv>h</span><span class=p>[</span><span class=nv>index</span><span class=p>](</span><span class=nv>b</span><span class=p>,</span> <span class=nv>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>0001385</span><span class=nf>E</span>                 <span class=nv>pop</span>     <span class=nb>esi</span>
</span></span><span class=line><span class=cl>    <span class=nl>.text:</span><span class=err>0001385</span><span class=nf>F</span>                 <span class=nv>retn</span>
</span></span></code></pre></td></tr></table></div></div><p>Overall, the decompiled code looks as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_13842</span><span class=p>(</span><span class=n>struct1</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=n>struct2</span><span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>struct3</span><span class=o>*</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>a</span><span class=o>-&gt;</span><span class=n>s3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span><span class=o>*</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>b</span><span class=o>-&gt;</span><span class=n>unknown0x8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=o>-&gt;</span><span class=n>unknown0x23</span> <span class=o>=</span> <span class=n>a</span><span class=o>-&gt;</span><span class=n>unknown0x23</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span> <span class=o>=</span> <span class=n>v1</span> <span class=o>-</span> <span class=mh>0x24</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=o>-&gt;</span><span class=n>s3</span> <span class=o>=</span> <span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v1</span><span class=o>-&gt;</span><span class=n>s2</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>index</span> <span class=o>=</span> <span class=n>v1</span><span class=o>-&gt;</span><span class=n>index</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span><span class=o>-&gt;</span><span class=n>unknown0x8</span><span class=o>+</span><span class=mh>0x38</span><span class=n>h</span><span class=p>[</span><span class=n>index</span><span class=p>](</span><span class=n>b</span><span class=p>,</span> <span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2017-07-22</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/ data-title="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6" data-via=evisneffos data-hashtags="Practical Reverse Engineering,x64,x86"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/ data-hashtag="Practical Reverse Engineering"><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/ data-title="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/ data-title="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/ data-title="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://soffensive.github.io/posts/practical-reverse-engineering/2017-07-22-practical-reverse-engineering-exercise-solutions-page-35-exercise-6/ data-title="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 6"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/practical-reverse-engineering/>Practical Reverse Engineering</a>,&nbsp;<a href=/tags/x64/>X64</a>,&nbsp;<a href=/tags/x86/>X86</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/practical-reverse-engineering/2017-07-16-practical-reverse-engineering-exercise-solutions-rtlvalidateunicodestring/ class=prev rel=prev title="Practical Reverse Engineering Exercise Solutions: RtlValidateUnicodeString"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Practical Reverse Engineering Exercise Solutions: RtlValidateUnicodeString</a>
<a href=/posts/practical-reverse-engineering/2017-07-30-practical-reverse-engineering-exercise-solutions-page-35-exercise-7/ class=next rel=next title="Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 7">Practical Reverse Engineering Exercise Solutions: Page 35 / Exercise 7<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.140.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e3},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>