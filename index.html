<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.140.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>soffensive blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://soffensive.github.io/">
<meta property="og:site_name" content="soffensive blog"><meta property="og:title" content="soffensive blog"><meta property="og:description" content="This is my cool site"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="soffensive blog"><meta name=twitter:description content="This is my cool site"><meta name=twitter:site content="@evisneffos"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://soffensive.github.io/><link rel=alternate href=/index.xml type=application/rss+xml title="soffensive blog"><link rel=feed href=/index.xml type=application/rss+xml title="soffensive blog"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/soffensive.github.io\/","inLanguage":"en","description":"This is my cool site","name":"soffensive blog"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="soffensive blog">soffensive blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/soffensive title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a class=menu-item href=https://twitter.com/evisneffos title=Twitter rel="noopener noreffer" target=_blank><i class='fab fa-twitter fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class="page home" data-home=posts><div class=home-profile><h1 class=home-title>soffensive blog</h1><div class=home-subtitle><div id=id-1 class=typeit></div></div><div class=links><a href=https://github.com/soffensive title=GitHub target=_blank rel="noopener noreffer me"><i class="fab fa-github fa-fw" aria-hidden=true></i></a><a href=https://twitter.com/evisneffos title=Twitter target=_blank rel="noopener noreffer me"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a></div></div><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/various/2024-12-26-make-and-makefile-security/>make and makefile</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2024-12-26>2024-12-26</time></span>&nbsp;<span class=post-category>included in <a href=/categories/ci/cd/><i class="far fa-folder fa-fw" aria-hidden=true></i>CI/CD</a></span></div><div class=content><p>I am a C/C++ newbie, but occassionally I have to compile or build projects. Since make (and Makefiles) are quite prevalent and sometimes they have to be adjusted due to potential errors, I had to learn more about them and want to share my learning publicly here.</p><h3 id=building-blocks>Building Blocks</h3><p>First of all, what are the involved building blocks of make and Makefiles?</p><ul><li><strong>make</strong>:<ul><li>The GNU make utility. This is the executable that you actually run in order to execute a series of commands in order to modify files, typically compiling programs.</li><li>If you run the program without specifying an explicit input file with the -f option, make will look for the makefiles GNUmakefile, makefile, and Makefile, in that order.</li><li>make updates a target if it depends on prerequisite files that have been modified since the target was last modified, or if the target does not exist.</li></ul></li><li><strong>makefile</strong>:<ul><li>This is the input file for the make utility and consists of a series of instructions how to modify files.</li><li>A makefile can contain one or more rules.</li></ul></li><li><strong>rule</strong>:<ul><li>A rule consists of one or more targets, prerequisites and commands.</li></ul></li><li><strong>target</strong>:<ul><li>A target is a file name and typically, there is only one per rule.</li></ul></li><li><strong>prerequisite</strong>:<ul><li>The prerequisites are file names, separated by spaces. These files need to exist before the commands for the target are run. These are also called dependencies.</li></ul></li><li><strong>command</strong>:<ul><li>The commands are a series of steps typically to make the target. They need to start with a tab character, not spaces.</li></ul></li></ul><p>The general format of a <code>Makefile</code> is as follows:</p></div><div class=post-footer><a href=/posts/various/2024-12-26-make-and-makefile-security/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/make/>Make</a>,&nbsp;<a href=/tags/makefile/>Makefile</a>,&nbsp;<a href=/tags/make-security/>Make Security</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/web-app-sec/2019-05-18-xxe-with-net-in-2019/>XXE with .NET in 2019</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2019-05-18>2019-05-18</time></span>&nbsp;<span class=post-category>included in <a href=/categories/web-application-security/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web Application Security</a></span></div><div class=content><p>After the seminal blog post by <a href=https://www.jardinesoftware.net/2016/05/26/xxe-and-net/ target=_blank rel="noopener noreffer">James Jardine</a> in 2016 on XXE exploitation in .NET applications back in 2016, Microsoft seems to have implemented some additional changes regarding the default behavior of XML parsers.</p><p>We work through the different XML methods provided and their corresponding vulnerable configurations. For all experiments, .NET framework 4.6 was chosen.</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>TL;DR<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>In order to create an XXE vulnerability for applications using .NET framework 4.6+, you have to instantiate a vulnerable <code>XmlResolver</code> beforehand.</p></div><div class=post-footer><a href=/posts/web-app-sec/2019-05-18-xxe-with-net-in-2019/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/xxe/>XXE</a>,&nbsp;<a href=/tags/microsoft/>Microsoft</a>,&nbsp;<a href=/tags/.net/>.NET</a>,&nbsp;<a href=/tags/web-application-security/>Web Application Security</a>,&nbsp;<a href=/tags/dtd/>DTD</a>,&nbsp;<a href=/tags/xml/>XML</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/web-app-sec/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/>Exploiting Blind File Reads / Path Traversal Vulnerabilities on Microsoft Windows Operating Systems</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-06-19>2018-06-19</time></span>&nbsp;<span class=post-category>included in <a href=/categories/web-application-security/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web Application Security</a></span></div><div class=content><p>In a recent engagement I was confronted with a blind path traversal vulnerability on a server running with the Microsoft Windows operating system. That is, it was not possible to display folder contents but the complete file name and path had to be guessed. Due to the lack of a comprehensive website I was forced to gather information from various different sources.</p><p>In this blog post, I want to summarize my findings and focus on the exploitation of  this kind of vulnerability.</p></div><div class=post-footer><a href=/posts/web-app-sec/2018-06-19-exploiting-blind-file-reads-path-traversal-vulnerabilities-on-microsoft-windows-operating-systems/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/web-application-security/>Web Application Security</a>,&nbsp;<a href=/tags/blind-file-reads/>Blind File Reads</a>,&nbsp;<a href=/tags/path-traversal/>Path Traversal</a>,&nbsp;<a href=/tags/windows/>Windows</a>,&nbsp;<a href=/tags/xxe/>XXE</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/web-app-sec/2018-04-23-exploiting-misconfigured-cors-null-origin/>Exploiting misconfigured CORS Null Origin</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-04-23>2018-04-23</time></span>&nbsp;<span class=post-category>included in <a href=/categories/web-application-security/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web Application Security</a></span></div><div class=content><p>Almost two years ago, in October 2016, James Kettle published an excellent <a href=http://blog.portswigger.net/2016/10/exploiting-cors-misconfigurations-for.html target=_blank rel="noopener noreffer">blog post</a> about the various types of Cross-Origin Resource Sharing (CORS) misconfigurations and how they can be exploited.</p><p>Recently, I encountered a web application that allowed for two-way interaction with the so-called null origin. More precisely, when sending an HTTP request specifying the header:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>Origin: null
</span></span></span></code></pre></td></tr></table></div></div><p>the server would respond with the following two HTTP headers:</p></div><div class=post-footer><a href=/posts/web-app-sec/2018-04-23-exploiting-misconfigured-cors-null-origin/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/cors/>Cors</a>,&nbsp;<a href=/tags/web-security/>Web Security</a>,&nbsp;<a href=/tags/cors-exploitation/>Cors Exploitation</a>,&nbsp;<a href=/tags/null-origin/>Null Origin</a>,&nbsp;<a href=/tags/misconfiguration/>Misconfiguration</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/ctf/2018-02-21-using-angr-and-symbolic-execution-for-reverse-engineering-challenges-rpi-mbe-labs/>Using angr and symbolic execution for reverse engineering challenges (RPI MBE Labs)</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-02-21>2018-02-21</time></span>&nbsp;<span class=post-category>included in <a href=/categories/ctf-challenges/><i class="far fa-folder fa-fw" aria-hidden=true></i>CTF Challenges</a></span></div><div class=content><p>This blog posts will highlight how you can utilize the angr dynamic binary analysis framework and symbolic execution for reverse engineering tasks.</p><p>More precisely, we will look at the first two tasks in the <code>lab1</code> of the <a href=https://github.com/RPISEC/MBE/tree/master/src/lab01 target=_blank rel="noopener noreffer">RPISEC MBE labs</a>.</p><p>While angr&rsquo;s internals are quite complex and require substantial effort for mastering, getting started for our simple examples requires not too much knowledge.  </p><h2 id=lab1c>lab1C</h2><p>The first example we will look at is <code>lab1C</code> from <code>lab01</code>, which requires the user to enter a certain password:</p></div><div class=post-footer><a href=/posts/ctf/2018-02-21-using-angr-and-symbolic-execution-for-reverse-engineering-challenges-rpi-mbe-labs/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/binary-analysis/>Binary Analysis</a>,&nbsp;<a href=/tags/ctf/>Ctf</a>,&nbsp;<a href=/tags/symbolic-execution/>Symbolic Execution</a>,&nbsp;<a href=/tags/angr/>Angr</a>,&nbsp;<a href=/tags/reverse-engineering/>Reverse Engineering</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h1 class=single-title itemprop="name headline"><a href=/posts/ctf/2018-01-23-pwnable-kr-crypto1-challenge/>pwnable.kr: crypto1 challenge</a></h1><div class=post-meta><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>soffensive</a></span>&nbsp;<span class=post-publish>published on <time datetime=2018-01-23>2018-01-23</time></span>&nbsp;<span class=post-category>included in <a href=/categories/ctf-challenges/><i class="far fa-folder fa-fw" aria-hidden=true></i>CTF Challenges</a></span></div><div class=content><p>In the pwnable.kr challenge <code>crypto1</code> in the rookies section, we are given the following two files <code>client.py</code> and <code>server.py</code>:</p><h2 id=clientpy>client.py</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>xmlrpclib</span>
</span></span><span class=line><span class=cl><span class=n>rpc</span> <span class=o>=</span> <span class=n>xmlrpclib</span><span class=o>.</span><span class=n>ServerProxy</span><span class=p>(</span><span class=s2>&#34;http://localhost:9100/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BLOCK_SIZE</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl><span class=n>PADDING</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>s</span><span class=p>:</span> <span class=n>s</span> <span class=o>+</span> <span class=p>(</span><span class=n>BLOCK_SIZE</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>%</span> <span class=n>BLOCK_SIZE</span><span class=p>)</span> <span class=o>*</span> <span class=n>PADDING</span>
</span></span><span class=line><span class=cl><span class=n>EncodeAES</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>c</span><span class=p>,</span> <span class=n>s</span><span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>pad</span><span class=p>(</span><span class=n>s</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>DecodeAES</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>c</span><span class=p>,</span> <span class=n>e</span><span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># server&#39;s secrets</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;erased. but there is something on the real source code&#39;</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s1>&#39;erased. but there is something on the real source code&#39;</span>
</span></span><span class=line><span class=cl><span class=n>cookie</span> <span class=o>=</span> <span class=s1>&#39;erased. but there is something on the real source code&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># guest / 8b465d23cb778d3636bf6c4c5e30d031675fd95cec7afea497d36146783fd3a1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sanitize</span><span class=p>(</span><span class=n>arg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>arg</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>c</span> <span class=ow>not</span> <span class=ow>in</span> <span class=s1>&#39;1234567890abcdefghijklmnopqrstuvwxyz-_&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>AES128_CBC</span><span class=p>(</span><span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>EncodeAES</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>request_auth</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=n>pw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>packet</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>{0}</span><span class=s1>-</span><span class=si>{1}</span><span class=s1>-</span><span class=si>{2}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=n>pw</span><span class=p>,</span> <span class=n>cookie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>e_packet</span> <span class=o>=</span> <span class=n>AES128_CBC</span><span class=p>(</span><span class=n>packet</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;sending encrypted data (</span><span class=si>{0}</span><span class=s1>)&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>e_packet</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>rpc</span><span class=o>.</span><span class=n>authenticate</span><span class=p>(</span><span class=n>e_packet</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;---------------------------------------------------&#39;</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;-       PWNABLE.KR secure RPC login system        -&#39;</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;---------------------------------------------------&#39;</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;Input your ID&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nb>id</span> <span class=o>=</span> <span class=n>raw_input</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;Input your PW&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>pw</span> <span class=o>=</span> <span class=n>raw_input</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>sanitize</span><span class=p>(</span><span class=nb>id</span><span class=p>)</span> <span class=o>==</span> <span class=kc>False</span> <span class=ow>or</span> <span class=n>sanitize</span><span class=p>(</span><span class=n>pw</span><span class=p>)</span> <span class=o>==</span> <span class=kc>False</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span> <span class=s1>&#39;format error&#39;</span>
</span></span><span class=line><span class=cl>		<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=n>os</span><span class=o>.</span><span class=n>_exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>cred</span> <span class=o>=</span> <span class=n>request_auth</span><span class=p>(</span><span class=nb>id</span><span class=p>,</span> <span class=n>pw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>cred</span><span class=o>==</span><span class=mi>0</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span> <span class=s1>&#39;you are not authenticated user&#39;</span>
</span></span><span class=line><span class=cl>		<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=n>os</span><span class=o>.</span><span class=n>_exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>cred</span><span class=o>==</span><span class=mi>1</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span> <span class=s1>&#39;hi guest, login as admin&#39;</span>
</span></span><span class=line><span class=cl>		<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=n>os</span><span class=o>.</span><span class=n>_exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=s1>&#39;hi admin, here is your flag&#39;</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;flag&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=serverpy>server.py</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>xmlrpclib</span><span class=o>,</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>SimpleXMLRPCServer</span> <span class=kn>import</span> <span class=n>SimpleXMLRPCServer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BLOCK_SIZE</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl><span class=n>PADDING</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>s</span><span class=p>:</span> <span class=n>s</span> <span class=o>+</span> <span class=p>(</span><span class=n>BLOCK_SIZE</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>%</span> <span class=n>BLOCK_SIZE</span><span class=p>)</span> <span class=o>*</span> <span class=n>PADDING</span>
</span></span><span class=line><span class=cl><span class=n>EncodeAES</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>c</span><span class=p>,</span> <span class=n>s</span><span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>pad</span><span class=p>(</span><span class=n>s</span><span class=p>))</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>DecodeAES</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>c</span><span class=p>,</span> <span class=n>e</span><span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># server&#39;s secrets</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s1>&#39;erased. but there is something on the real source code&#39;</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s1>&#39;erased. but there is something on the real source code&#39;</span>
</span></span><span class=line><span class=cl><span class=n>cookie</span> <span class=o>=</span> <span class=s1>&#39;erased. but there is something on the real source code&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>AES128_CBC</span><span class=p>(</span><span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>DecodeAES</span><span class=p>(</span><span class=n>cipher</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=n>PADDING</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>authenticate</span><span class=p>(</span><span class=n>e_packet</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>packet</span> <span class=o>=</span> <span class=n>AES128_CBC</span><span class=p>(</span><span class=n>e_packet</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nb>id</span> <span class=o>=</span> <span class=n>packet</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>pw</span> <span class=o>=</span> <span class=n>packet</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>packet</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>)[</span><span class=mi>2</span><span class=p>]</span> <span class=o>!=</span> <span class=n>cookie</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=mi>0</span>	<span class=c1># request is not originated from expected server</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=nb>id</span><span class=o>+</span><span class=n>cookie</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span> <span class=o>==</span> <span class=n>pw</span> <span class=ow>and</span> <span class=nb>id</span> <span class=o>==</span> <span class=s1>&#39;guest&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=nb>id</span><span class=o>+</span><span class=n>cookie</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span> <span class=o>==</span> <span class=n>pw</span> <span class=ow>and</span> <span class=nb>id</span> <span class=o>==</span> <span class=s1>&#39;admin&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>server</span> <span class=o>=</span> <span class=n>SimpleXMLRPCServer</span><span class=p>((</span><span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=mi>9100</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;Listening on port 9100...&#34;</span>
</span></span><span class=line><span class=cl><span class=n>server</span><span class=o>.</span><span class=n>register_function</span><span class=p>(</span><span class=n>authenticate</span><span class=p>,</span> <span class=s2>&#34;authenticate&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>server</span><span class=o>.</span><span class=n>serve_forever</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=analysis>Analysis</h2><p>Furthermore, there is a running instance of <code>client.py</code> at <code>pwnable.kr</code> on port <code>9006</code>. Our goal is to connect to this service and retrieve the flag.</p></div><div class=post-footer><a href=/posts/ctf/2018-01-23-pwnable-kr-crypto1-challenge/>Read More</a><div class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/pwnable.kr/>Pwnable.kr</a>,&nbsp;<a href=/tags/ctf/>Ctf</a>,&nbsp;<a href=/tags/crypto1/>Crypto1</a>,&nbsp;<a href=/tags/cryptography/>Cryptography</a></div></div></article><ul class=pagination><li class="page-item active"><span class=page-link><a href=/>1</a></span></li><li class=page-item><span class=page-link><a href=/page/2/>2</a></span></li><li class=page-item><span class=page-link><a href=/page/3/>3</a></span></li><li class=page-item><span class=page-link aria-hidden=true>&mldr;</span></li><li class=page-item><span class=page-link><a href=/page/6/>6</a></span></li></ul></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.140.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e3},data:{"id-1":"Another blog about software security issues"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"]},duration:-1,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>